<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.3.1" /><meta property="og:title" content="How to Add Customized Sequence Track" /><meta property="og:locale" content="en" /><meta name="description" content="How Sequencer Works?" /><meta property="og:description" content="How Sequencer Works?" /><link rel="canonical" href="https://cymhellfire.github.io/posts/How-To-Add-Customized-Sequence-Track/" /><meta property="og:url" content="https://cymhellfire.github.io/posts/How-To-Add-Customized-Sequence-Track/" /><meta property="og:site_name" content="Vault" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-05-04T14:41:02+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="How to Add Customized Sequence Track" /><meta name="twitter:site" content="@" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-05-06T20:51:16+08:00","datePublished":"2022-05-04T14:41:02+08:00","description":"How Sequencer Works?","headline":"How to Add Customized Sequence Track","mainEntityOfPage":{"@type":"WebPage","@id":"https://cymhellfire.github.io/posts/How-To-Add-Customized-Sequence-Track/"},"url":"https://cymhellfire.github.io/posts/How-To-Add-Customized-Sequence-Track/"}</script><title>How to Add Customized Sequence Track | Vault</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Vault"><meta name="application-name" content="Vault"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> </a></div><div class="site-title"> <a href="/">Vault</a></div><div class="site-subtitle font-italic">Learning, thinking, sharing.</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/cymhellfire" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['cym-hellfire','qq.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>How to Add Customized Sequence Track</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>How to Add Customized Sequence Track</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1651646462" data-df="ll" data-toggle="tooltip" data-placement="bottom"> May 4, 2022 </em> </span> <span> Updated <em class="" data-ts="1651841476" data-df="ll" data-toggle="tooltip" data-placement="bottom"> May 6, 2022 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://github.com/cymhellfire">alexymcai</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="3670 words"> <em>20 min</em> read</span></div></div></div><div class="post-content"><h2 id="how-sequencer-works"><span class="mr-2">How Sequencer Works?</span><a href="#how-sequencer-works" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>This chapter focuses on the <em>Sequencer</em> relavent classes to figure out the basic mechanism that <em>Sequencer</em> works. The UML diagram below shows some of the relavent classes and the relationship between them.</p><p><img data-src="/img/2022-05-04-How-To-Add-Customized-Sequence-Track/UE-Sequencer-Track-UML.jpg" alt="UE-Sequencer-UML" data-proofer-ignore> <em>Sequeuncer UML</em></p><blockquote class="prompt-tip"><div><p>Actually the <em>Sequencer</em> are driven by <strong>ECS</strong> architecture for better performance, but it’s not the time to dig in <strong>ECS</strong>.</p></div></blockquote><h3 id="sequencer-data-struct-classes"><span class="mr-2">Sequencer Data Struct Classes</span><a href="#sequencer-data-struct-classes" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>In the middle of the diagram, <strong>UMovieSceneSequence</strong> <strong>UMovieScene</strong> <strong>UMovieSceneTrack</strong> and <strong>UMovieSceneSection</strong> are the basic classes construct the <em>Sequencer</em> data. They have decreasing granularity from top to the bottom. Behavior relavent data are serialized in <strong>UMovieSceneSection</strong> instances. Here is a screenshot to show how they are composed in <em>Sequencer</em>.</p><p><img data-src="/img/2022-05-04-How-To-Add-Customized-Sequence-Track/UE-Editor-Sequencer-Screenshot.png" alt="UE-Editor-Sequencer-Screenshot" data-proofer-ignore> <em>Sequencer Window</em></p><h3 id="sequencer-window-drawing-classes"><span class="mr-2">Sequencer Window Drawing Classes</span><a href="#sequencer-window-drawing-classes" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Classes on the left are related to editor window rendering. The key class for adding customized track and sections is <strong>FSequencerSection</strong>. This class is in charged of creating the <em>Widget</em> of corresponding section and painting its background. Without this class, no section can be seen in the <em>Sequencer</em> window. The functions shows in UML diagram is the same as the content of refresh rendering callstack.</p><h3 id="sequencer-runtime-classes"><span class="mr-2">Sequencer Runtime Classes</span><a href="#sequencer-runtime-classes" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>The right part contains classes take in count when evaluate the sequence at runtime.</p><ul><li><strong>UMovieSceneSequencePlayer</strong> is the toppest class to receive Play/Pause/Stop command. It also controls the underlying classes to perform corresponding behavior.<li><strong>FMovieSceneRootEvaluationTemplateInstance</strong> is the root class holds all the runtime evaluation data of current sequeuece.<li><strong>UMovieSceneCompiledDataManager</strong> has both serialization/deserialization functionality for sequence evaluation data. It also does compile work when any part of current sequence has changed, this ensures that the <em>Sequencer</em> window shows the latest data. It will ask corresponding <strong>UMovieSceneTrack</strong> object for creating <strong>FMovieSceneEvalTemplate</strong> instance for new adding section, and record the new template into <strong>FMovieSceneEvaluationTrack</strong> class.<li><strong>FMovieSceneEvaluationTemplate</strong> and <strong>FMovieSceneEvaluationTrack</strong> are two common data organizer classes.<li><strong>FMovieSceneEvalTemplate</strong> are the key class to perform evaluating behavior of sequence sections. Here list out three functions will be executed during the sequence playing.<ul><li><em>Setup()</em> triggers only once when evaluation entered the section. It’s usually used to initialize the section logic and create <strong>IPersistentEvaluationData</strong>.<li><em>TearDown()</em> is the same as <em>Setup</em> but triggered when section is end. Resources and reference releasing operation can be executed here.<li><em>Evaluate()</em> function will be executed every frame during playing. Any continunous logic should be placed here. In generally, <strong>IMovieSceneExecutionToken</strong> instances are created here.</ul></ul><p><img data-src="/img/2022-05-04-How-To-Add-Customized-Sequence-Track/UE-EvalTemplate-Event.png" alt="UE-EvalTemplate-Event" data-proofer-ignore> <em>Execute Timing</em></p><ul><li>Any class derived from <strong>IMovieSceneExecutionToken</strong> interface is used as a executing token. The logic in its <em>Execute()</em> function will be executed during evaluation. It’s usually created by <strong>FMovieSceneEvalTemplate</strong> class and added to <strong>FMovieSceneExecutionTokens</strong> struct for later evaluation.<li>Any class derived from <strong>IPersistentEvaluationData</strong> interface is used as data container for section behavior. It’s created by <strong>FMovieSceneEvalTemplate</strong> and recorded in <strong>FPersistentEvaluationData</strong> struct.</ul><blockquote class="prompt-tip"><div><p>Other classes are not important for add customized section, no more details placed here.</p></div></blockquote><h2 id="add-customized-track"><span class="mr-2">Add Customized Track</span><a href="#add-customized-track" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>A brand new track needs one <em>Runtime</em> module and one <em>Editor</em> module for fully operational.</p><ul><li><em>Runtime</em> module: Implements the classes contains actual logic of new track.<li><em>Editor</em> module: Implements the editor helper classes that ensure new track and sections can be rendered in <strong>Sequencer</strong> window.</ul><h3 id="runtime-module"><span class="mr-2">Runtime Module</span><a href="#runtime-module" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h4 id="umoviescenenewtrack"><span class="mr-2">UMovieSceneNewTrack</span><a href="#umoviescenenewtrack" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>The very basic class is derived from <strong>UMovieSceneTrack</strong> and <strong>IMovieSceneTrackTemplateProducer</strong>. Create a new header file and type following code.</p><div file="UMovieSceneNewTrack.h" class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="UMovieSceneNewTrack.h"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
</pre><td class="rouge-code"><pre>UCLASS()
class CUSTOMIZETRACK_API UMovieSceneNewTrack: public UMovieSceneNameableTrack, public IMovieSceneTrackTemplateProducer
{
	GENERATED_BODY()

public:
	UMovieSceneNewTrack()
	{
#if WITH_EDITORONLY_DATA
		TrackTint = FColor::Red;
#endif
	}

	// UMovieSceneTrack interface
	virtual void AddSection(UMovieSceneSection&amp; Section) override { Sections.Add(&amp;Section); }
	virtual bool SupportsType(TSubclassOf&lt;UMovieSceneSection&gt; SectionClass) const override;
	virtual UMovieSceneSection* CreateNewSection() override;
	virtual const TArray&lt;UMovieSceneSection*&gt;&amp; GetAllSections() const override { return Sections; }
	virtual bool HasSection(const UMovieSceneSection&amp; Section) const override { return Sections.Contains(&amp;Section); }
	virtual bool IsEmpty() const override { return Sections.Num() == 0; }
	virtual void RemoveSection(UMovieSceneSection&amp; Section) override { Sections.Remove(&amp;Section); }
	virtual void RemoveSectionAt(int32 SectionIndex) override { Sections.RemoveAt(SectionIndex); }
	virtual bool SupportsMultipleRows() const override { return true; }

	// IMovieSceneTrackTemplateProducer interface
	virtual FMovieSceneEvalTemplatePtr CreateTemplateForSection(const UMovieSceneSection&amp; InSection) const override;

#if WITH_EDITOR
	virtual FText GetDefaultDisplayName() const override;
#endif

protected:
	UPROPERTY()
	TArray&lt;UMovieSceneSection*&gt; Sections;
};
</pre></table></code></div></div><p>The comments show that the functions’ source. Variable <strong>Sections</strong> records all children sections of this track. <em>CreateTemplateForSection()</em> function is used to create <strong>FMovieSceneEvalTemplate</strong> instance for evaluation. Create new file named as <strong>UMovieSceneNewTrack.cpp</strong> and type following code.</p><div file="UMovieSceneNewTrack.cpp" class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="UMovieSceneNewTrack.cpp"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre><td class="rouge-code"><pre>#define LOCTEXT_NAMESPACE "MovieSceneNewTrack"

bool UMovieSceneNewTrack::SupportsType(TSubclassOf&lt;UMovieSceneSection&gt; SectionClass) const
{
	return SectionClass == UMovieSceneNewTrackSection::StaticClass();
}

UMovieSceneSection* UMovieSceneNewTrack::CreateNewSection()
{
	return NewObject&lt;UMovieSceneNewTrackSection&gt;(this, NAME_None, RF_Transactional);
}

FMovieSceneEvalTemplatePtr UMovieSceneNewTrack::CreateTemplateForSection(const UMovieSceneSection&amp; InSection) const
{
	if (const UMovieSceneNewTrackSection* NewTrackSection = Cast&lt;const UMovieSceneNewTrackSection&gt;(&amp;InSection))
	{
		return FMovieSceneNewTrackSectionTemplate(*NewTrackSection);
	}

	return FMovieSceneEvalTemplatePtr();
}

#if WITH_EDITOR
FText UMovieSceneNewTrack::GetDefaultDisplayName() const
{
	return LOCTEXT("NewTrack", "New Track");
}
#endif

#undef LOCTEXT_NAMESPACE
</pre></table></code></div></div><h4 id="umoviescenenewtracksection"><span class="mr-2">UMovieSceneNewTrackSection</span><a href="#umoviescenenewtracksection" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>As mentioned before, a section class is also required. Create a new file named <strong>MovieSceneNewTrackSection.h</strong> and add following code.</p><div file="MovieSceneNewTrackSection.h" class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="MovieSceneNewTrackSection.h"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>UCLASS()
class CUSTOMIZETRACK_API UMovieSceneNewTrackSection : public UMovieSceneSection
{
	GENERATED_BODY()
public:
	UMovieSceneNewTrackSection() {}
};
</pre></table></code></div></div><p>Leave it empty for now, any extend logic can be added later.</p><h4 id="fmoviescenenewtracksectiontemplate"><span class="mr-2">FMovieSceneNewTrackSectionTemplate</span><a href="#fmoviescenenewtracksectiontemplate" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Now create the runtime evaluation relative classes. Add new file named as <strong>MovieSceneNewTrackSectionTemplate.h</strong> and add following code.</p><div file="MovieSceneNewTrackSectionTemplate.h" class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="MovieSceneNewTrackSectionTemplate.h"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre><td class="rouge-code"><pre>class UMovieSceneNewTrackSection;

USTRUCT()
struct FMovieSceneNewTrackSectionTemplate : public FMovieSceneEvalTemplate
{
	GENERATED_BODY()

	FMovieSceneNewTrackSectionTemplate()
		: Section(nullptr)
	{}
	FMovieSceneNewTrackSectionTemplate(const UMovieSceneNewTrackSection&amp; InSection);

	virtual void SetupOverrides() override
	{
		EnableOverrides(RequiresSetupFlag | RequiresTearDownFlag);
	}

	virtual void Evaluate(const FMovieSceneEvaluationOperand&amp; Operand, const FMovieSceneContext&amp; Context,
		const FPersistentEvaluationData&amp; PersistentData, FMovieSceneExecutionTokens&amp; ExecutionTokens) const override;
protected:
	virtual void Setup(FPersistentEvaluationData&amp; PersistentData, IMovieScenePlayer&amp; Player) const override;
	virtual void TearDown(FPersistentEvaluationData&amp; PersistentData, IMovieScenePlayer&amp; Player) const override;

	virtual UScriptStruct&amp; GetScriptStructImpl() const override { return *StaticStruct(); }

	UPROPERTY()
	const UMovieSceneNewTrackSection* Section;
};
</pre></table></code></div></div><p>Following the source file content.</p><div file="MovieSceneNewTrackSectionTemplate.cpp" class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="MovieSceneNewTrackSectionTemplate.cpp"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
</pre><td class="rouge-code"><pre>struct FNewSectionEvaluationData;

struct FNewSectionExecutionToken : IMovieSceneExecutionToken
{
	virtual void Execute(const FMovieSceneContext&amp; Context, const FMovieSceneEvaluationOperand&amp; Operand, FPersistentEvaluationData&amp; PersistentData, IMovieScenePlayer&amp; Player) override
	{
		FNewSectionEvaluationData&amp; EvaluationData = PersistentData.GetSectionData&lt;FNewSectionEvaluationData&gt;();
	}
};

struct FNewSectionEvaluationData : IPersistentEvaluationData
{
	
};

FMovieSceneNewTrackSectionTemplate::FMovieSceneNewTrackSectionTemplate(const UMovieSceneNewTrackSection&amp; InSection)
{
	Section = &amp;InSection;
}

void FMovieSceneNewTrackSectionTemplate::Evaluate(const FMovieSceneEvaluationOperand&amp; Operand,
	const FMovieSceneContext&amp; Context, const FPersistentEvaluationData&amp; PersistentData,
	FMovieSceneExecutionTokens&amp; ExecutionTokens) const
{
	ExecutionTokens.Add(FNewSectionExecutionToken());
}

void FMovieSceneNewTrackSectionTemplate::Setup(FPersistentEvaluationData&amp; PersistentData,
	IMovieScenePlayer&amp; Player) const
{
	PersistentData.AddSectionData&lt;FNewSectionEvaluationData&gt;();
}

void FMovieSceneNewTrackSectionTemplate::TearDown(FPersistentEvaluationData&amp; PersistentData,
	IMovieScenePlayer&amp; Player) const
{
	
}
</pre></table></code></div></div><p>This file contains three different class/struct. Except class <strong>FMovieSceneNewTrackSectionTemplate</strong>, derived class of <strong>IMovieSceneExecutionToken</strong> and <strong>IPersistentEvaluationData</strong> are also implemented here. For demonstration purpose, there is no extra logic in these classes.</p><p>For now, the runtime part is finished. It’s time to focus on editor side.</p><h3 id="editor-module"><span class="mr-2">Editor Module</span><a href="#editor-module" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h4 id="fnewtrackeditor"><span class="mr-2">FNewTrackEditor</span><a href="#fnewtrackeditor" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>There should be a dedicated track editor class for every single track class. Track editor class covers following functionalities:</p><ul><li>Create track/section instances and establish the relation between new instance and parent sequence.<li>Construct <em>Sequencer</em> window menus for new track and section classes. Create a new header file named <strong>NewTrackEditor.h</strong> in <em>Editor</em> module and add following code. ``` class UMovieSceneNewTrackSection;</ul><p>class CUSTOMIZETRACKEDITOR_API FNewTrackEditor : public FMovieSceneTrackEditor { public: static TSharedRef<ISequencerTrackEditor> CreateTrackEditor(TSharedRef<ISequencer> InSequencer);</ISequencer></ISequencerTrackEditor></p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>FNewTrackEditor(TSharedRef&lt;ISequencer&gt; InSequencer);

// ISequencerTrackEditor interface
virtual void BuildAddTrackMenu(FMenuBuilder&amp; MenuBuilder) override;
virtual TSharedPtr&lt;SWidget&gt; BuildOutlinerEditWidget(const FGuid&amp; ObjectBinding, UMovieSceneTrack* Track, const FBuildEditWidgetParams&amp; Params) override;
virtual bool SupportsType(TSubclassOf&lt;UMovieSceneTrack&gt; TrackClass) const override;
virtual bool SupportsSequence(UMovieSceneSequence* InSequence) const override;

virtual TSharedRef&lt;ISequencerSection&gt; MakeSectionInterface(UMovieSceneSection&amp; SectionObject, UMovieSceneTrack&amp; Track, FGuid ObjectBinding) override;
</pre></table></code></div></div><p>protected: UMovieSceneNewTrackSection* AddNewSection(UMovieScene* MovieScene, UMovieSceneTrack* InTrack);</p><div file="NewTrackEditor.h" class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="NewTrackEditor.h"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>void HandleAddNewTrackMenuEntryExecute();
void OnAddNewSection(UMovieSceneTrack* MovieSceneTrack);
TSharedRef&lt;SWidget&gt; BuildAddNewSectionMenu(UMovieSceneTrack* MovieSceneTrack); }; ```
</pre></table></code></div></div><p>In the corresponding source file NewTrackEditor.cpp, add following code.</p><div file="NewTrackEditor.cpp" class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="NewTrackEditor.cpp"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
</pre><td class="rouge-code"><pre>#define LOCTEXT_NAMESPACE "FNewTrackEditor"

TSharedRef&lt;ISequencerTrackEditor&gt; FNewTrackEditor::CreateTrackEditor(TSharedRef&lt;ISequencer&gt; InSequencer)
{
	return MakeShareable(new FNewTrackEditor(InSequencer));
}

FNewTrackEditor::FNewTrackEditor(TSharedRef&lt;ISequencer&gt; InSequencer)
	: FMovieSceneTrackEditor(InSequencer)
{
}

void FNewTrackEditor::BuildAddTrackMenu(FMenuBuilder&amp; MenuBuilder)
{
	MenuBuilder.AddMenuEntry(
		LOCTEXT("AddNewTrack", "New Track"),
		LOCTEXT("AddNewTrackTooltip", "Adds a new track that contains new sections."),
		FSlateIcon(FEditorStyle::GetStyleSetName(), "Sequencer.Tracks.Fade"),
		FUIAction(
			FExecuteAction::CreateRaw(this, &amp;FNewTrackEditor::HandleAddNewTrackMenuEntryExecute)
			)
		);
}

TSharedPtr&lt;SWidget&gt; FNewTrackEditor::BuildOutlinerEditWidget(const FGuid&amp; ObjectBinding, UMovieSceneTrack* Track,
	const FBuildEditWidgetParams&amp; Params)
{
	return FSequencerUtilities::MakeAddButton(
		LOCTEXT("AddNewSection", "Section"),
		FOnGetContent::CreateSP(this, &amp;FNewTrackEditor::BuildAddNewSectionMenu, Track),
		Params.NodeIsHovered, GetSequencer());
}

TSharedRef&lt;SWidget&gt; FNewTrackEditor::BuildAddNewSectionMenu(UMovieSceneTrack* MovieSceneTrack)
{
	FMenuBuilder MenuBuilder(true, nullptr);

	MenuBuilder.AddMenuEntry(
		LOCTEXT("AddNewSection", "New Section"),
		LOCTEXT("AddNewSectionTooltip", "Add a new section."),
		FSlateIcon(),
		FUIAction(FExecuteAction::CreateSP(this, &amp;FNewTrackEditor::OnAddNewSection, MovieSceneTrack)));

	return MenuBuilder.MakeWidget();
}

void FNewTrackEditor::OnAddNewSection(UMovieSceneTrack* MovieSceneTrack)
{
	UMovieScene* FocusedMovieScene = GetFocusedMovieScene();
	if (FocusedMovieScene == nullptr)
	{
		return;
	}

	UMovieSceneNewTrackSection* NewSection = AddNewSection(FocusedMovieScene, MovieSceneTrack);

	GetSequencer()-&gt;NotifyMovieSceneDataChanged(EMovieSceneDataChangeType::MovieSceneStructureItemAdded);
}

UMovieSceneNewTrackSection* FNewTrackEditor::AddNewSection(UMovieScene* MovieScene, UMovieSceneTrack* InTrack)
{
	const FScopedTransaction Transaction(LOCTEXT("AddNewSection_Transaction", "Add new section to track."));

	InTrack-&gt;Modify();

	UMovieSceneNewTrackSection* NewSection = CastChecked&lt;UMovieSceneNewTrackSection&gt;(InTrack-&gt;CreateNewSection());

	TRange&lt;FFrameNumber&gt; SectionRange = MovieScene-&gt;GetPlaybackRange();
	NewSection-&gt;SetRange(SectionRange);

	int32 RowIndex = -1;
	for (const UMovieSceneSection* Section : InTrack-&gt;GetAllSections())
	{
		RowIndex = FMath::Max(RowIndex, Section-&gt;GetRowIndex());
	}
	NewSection-&gt;SetRowIndex(RowIndex + 1);

	InTrack-&gt;AddSection(*NewSection);

	return NewSection;
}

bool FNewTrackEditor::SupportsType(TSubclassOf&lt;UMovieSceneTrack&gt; TrackClass) const
{
	return TrackClass == UMovieSceneNewTrack::StaticClass();
}

bool FNewTrackEditor::SupportsSequence(UMovieSceneSequence* InSequence) const
{
	return true;
}

void FNewTrackEditor::HandleAddNewTrackMenuEntryExecute()
{
	UMovieScene* FocusedMovieScene = GetFocusedMovieScene();

	if (FocusedMovieScene == nullptr || FocusedMovieScene-&gt;IsReadOnly())
	{
		return;
	}

	const FScopedTransaction Transaction(LOCTEXT("AddNewTrack_Transaction", "Add New Track"));
	FocusedMovieScene-&gt;Modify();

	auto NewTrack = FocusedMovieScene-&gt;AddMasterTrack&lt;UMovieSceneNewTrack&gt;();
	check(NewTrack);

	auto CurSequencer = GetSequencer();
	CurSequencer-&gt;NotifyMovieSceneDataChanged(EMovieSceneDataChangeType::MovieSceneStructureItemAdded);
}

TSharedRef&lt;ISequencerSection&gt; FNewTrackEditor::MakeSectionInterface(UMovieSceneSection&amp; SectionObject,
	UMovieSceneTrack&amp; Track, FGuid ObjectBinding)
{
	UMovieSceneNewTrackSection* NewTrackSection = Cast&lt;UMovieSceneNewTrackSection&gt;(&amp;SectionObject);
	check(SupportsType(SectionObject.GetOuter()-&gt;GetClass()) &amp;&amp; NewTrackSection != nullptr);

	return MakeShareable( new FNewTrackSection(*NewTrackSection));
}

#undef LOCTEXT_NAMESPACE
</pre></table></code></div></div><p>This class derived from <strong>FMovieSceneTrackEditor</strong> and specified the support type as <strong>UMovieSceneNewTrack</strong>. There is several menu constructor functions, here post some screenshot to introduce the correspondence between code and actual menu.</p><ul><li><em>BuildAddTrackMenu</em>: Construct the button in <strong>Add Track</strong> menu. <img data-src="/img/2022-05-04-How-To-Add-Customized-Sequence-Track/UE-BuildAddTrackMenu.png" alt="UE-BuildAddTrackMenu" data-proofer-ignore> <em>BuildAddTrackMenu</em><li><em>BuildOutlinerEditWidget</em>: Construct the “+” button on the track item. <img data-src="/img/2022-05-04-How-To-Add-Customized-Sequence-Track/UE-BuildOutlinerEditWidget.png" alt="UE-BuildOutlinerEditWidget" data-proofer-ignore> <em>BuildOutlinerEditWidget</em><li><em>BuildTrackContextMenu</em>: Construct extra options in the right click popup menu of track item. <img data-src="/img/2022-05-04-How-To-Add-Customized-Sequence-Track/UE-BuildTrackContextMenu.png" alt="UE-BuildTrackContextMenu" data-proofer-ignore> <em>BuildTrackContextMenu</em> In the example code, <strong>BuildTrackContextMenu</strong> is not implemented since it’s not necessary.</ul><p>Another important function is <em>MakeSectionInterface</em>. This function instantiate <strong>FNewTrackSection</strong> (this will be introduce in next part) for every new section instance. Without this function, no section can be rendered in <em>Sequencer</em> window.</p><h4 id="fnewtracksection"><span class="mr-2">FNewTrackSection</span><a href="#fnewtracksection" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Derived from <strong>FSequencerSection</strong> and do the rendering job for section instances. Create new source files named <strong>NewTrackSection.h</strong> and <strong>NewTrackSection.cpp</strong> then add following code.</p><div file="NewTrackSection.h" class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="NewTrackSection.h"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>class CUSTOMIZETRACKEDITOR_API FNewTrackSection : public FSequencerSection
{
public:
	FNewTrackSection(UMovieSceneSection&amp; InSectionObject);

	virtual int32 OnPaintSection(FSequencerSectionPainter&amp; Painter) const override;

	virtual FText GetSectionTitle() const override;
};
</pre></table></code></div></div><div file="NewTrackSection.cpp" class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="NewTrackSection.cpp"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre>FNewTrackSection::FNewTrackSection(UMovieSceneSection&amp; InSectionObject)
	: FSequencerSection(InSectionObject)
{
}

int32 FNewTrackSection::OnPaintSection(FSequencerSectionPainter&amp; Painter) const
{
	return Painter.PaintSectionBackground();
}

FText FNewTrackSection::GetSectionTitle() const
{
	return FText::FromString(TEXT("NewSection"));
}
</pre></table></code></div></div><p>Two functions are implemented for rendering purpose.</p><ul><li><em>OnPaintSection</em>: Simply draw a rectangle as the section duration in sequence track.<li><em>GetSectionTitle</em>: Override the text displayed on top of the section item.</ul><p><img data-src="/img/2022-05-04-How-To-Add-Customized-Sequence-Track/UE-TrackSection.png" alt="UE-TrackSection" data-proofer-ignore> <em>Rendering Result</em></p><blockquote class="prompt-tip"><div><p><strong>FSequencerSection</strong> also provides more functions like <em>GenerateSectionWidget</em> to customize the section appearance.</p></div></blockquote><h4 id="register-new-track-editor"><span class="mr-2">Register New Track Editor</span><a href="#register-new-track-editor" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>The final step to enable new track edtior in <em>Sequencer</em> window is register the new track editor class to <em>Sequencer</em> module. Open the source file of editor module, <strong>CustomizeTrackEditor.cpp</strong> in my case. Add registration code to <em>StartupModule</em> function and unregistration in <em>Shutdown</em> like following.</p><div file="CustomizeTrackEditor.cpp" class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="CustomizeTrackEditor.cpp"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre>void FCustomizeTrackEditorModule::StartupModule()
{
	UE_LOG(LogTemp, Log, TEXT("[CustomizeTrackEditor] Startup"));

	ISequencerModule&amp; SequencerModule = FModuleManager::Get().LoadModuleChecked&lt;ISequencerModule&gt;("Sequencer");
	// Register new track editor
	NewTrackCreateEditorHandle = SequencerModule.RegisterTrackEditor(FOnCreateTrackEditor::CreateStatic(&amp;FNewTrackEditor::CreateTrackEditor));
}

void FCustomizeTrackEditorModule::ShutdownModule()
{
	UE_LOG(LogTemp, Log, TEXT("[CustomizeTrackEditor] Shutdown"));

	ISequencerModule&amp; SequencerModule = FModuleManager::Get().GetModuleChecked&lt;ISequencerModule&gt;( "Sequencer" );
	// Unregister callback handle
	SequencerModule.UnRegisterTrackEditor(NewTrackCreateEditorHandle);
}
</pre></table></code></div></div><p>Save and compile, the new track should be available in <em>Sequencer</em> window.</p><h2 id="add-new-event-track"><span class="mr-2">Add New Event Track</span><a href="#add-new-event-track" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Previous chapter described how to add a section formed track, this one will talk about the event track. Unlike the section tracks, event track usually has only one infinite length section. All the activated events are located on the section area. Its mechanism is also different, before actual adding new track, let’s check the new involved classes for making event track works.</p><h3 id="new-involved-classes"><span class="mr-2">New Involved Classes</span><a href="#new-involved-classes" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Here is a UML diagram includes necessary classes for event track.</p><p><img data-src="/img/2022-05-04-How-To-Add-Customized-Sequence-Track/UE-Sequencer-Event-Track-UML.jpg" alt="UE-Sequencer-Event-Track-UML" data-proofer-ignore> <em>Event Track UML</em></p><blockquote class="prompt-tip"><div><p>All other classes shown before is hidden in this UML. All classes use actual name in sample code.</p></div></blockquote><p>The middle part is very similiar to section track UML diagram. Here introduce new invovled classes one by one:</p><ul><li>New section class need implemented <strong>IMovieSceneEntityProvider</strong> interface which provides ability to generate triggerable event entities.<li><strong>FMovieSceneNewEventChannel</strong> derived from <strong>FMovieSceneChannel</strong> class. It manipulates time and data struct of all created events.<li><strong>UMovieSceneNewEventSystem</strong> is the logic executor class. It’s triggered during evaluation and run the event logic once the time matches.<li><strong>FMovieSceneNewEventTriggerData</strong> is the actual data used when event is triggered. The instances are created by <em>ImportEntityImpl</em> function of <strong>UMovieSceneNewEventTriggerSection</strong> class and sent to <strong>UMovieSceneNewEventSystem</strong> class for later triggering. The difference between it and <strong>FMovieSceneNewEvent</strong> is that this struct also contains evaluation relevant data like the time point of trigger.</ul><h3 id="runtime-module-1"><span class="mr-2">Runtime Module</span><a href="#runtime-module-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h4 id="umoviesceneneweventtrack"><span class="mr-2">UMovieSceneNewEventTrack</span><a href="#umoviesceneneweventtrack" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>The track class is every similiar to section track’s one. Only thing to do is change the support type to correspongding classes.</p><h4 id="umoviesceneneweventtriggersection"><span class="mr-2">UMovieSceneNewEventTriggerSection</span><a href="#umoviesceneneweventtriggersection" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>The section class need to turn on infinite range support since the event section always covers the hold track to ensure all events are available. Implementing <strong>IMovieSceneEntityProvider</strong> interface is also a must done work.</p><div file="MovieSceneNewEventTriggerSection.h" class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="MovieSceneNewEventTriggerSection.h"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre>UCLASS()
class CUSTOMIZETRACK_API UMovieSceneNewEventTriggerSection : public UMovieSceneSection
	, public IMovieSceneEntityProvider
{
	GENERATED_BODY()
public:

	UMovieSceneNewEventTriggerSection();

	// IMovieSceneEntityProvider
	virtual bool PopulateEvaluationFieldImpl(const TRange&lt;FFrameNumber&gt;&amp; EffectiveRange, const FMovieSceneEvaluationFieldEntityMetaData&amp; InMetaData, FMovieSceneEntityComponentFieldBuilder* OutFieldBuilder) override;
	virtual void ImportEntityImpl(UMovieSceneEntitySystemLinker* EntityLinker, const FEntityImportParams&amp; Params, FImportedEntity* OutImportedEntity) override;

	UPROPERTY()
	FMovieSceneNewEventChannel EventChannel;
};
</pre></table></code></div></div><div file="MovieSceneNewEventTriggerSection.cpp" class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="MovieSceneNewEventTriggerSection.cpp"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
</pre><td class="rouge-code"><pre>UMovieSceneNewEventTriggerSection::UMovieSceneNewEventTriggerSection()
{
	bSupportsInfiniteRange = true;
	SetRange(TRange&lt;FFrameNumber&gt;::All());

#if WITH_EDITOR
	ChannelProxy = MakeShared&lt;FMovieSceneChannelProxy&gt;(EventChannel, FMovieSceneChannelMetaData());
#endif
}

bool UMovieSceneNewEventTriggerSection::PopulateEvaluationFieldImpl(const TRange&lt;FFrameNumber&gt;&amp; EffectiveRange, 
	const FMovieSceneEvaluationFieldEntityMetaData&amp; InMetaData, FMovieSceneEntityComponentFieldBuilder* OutFieldBuilder)
{
	const int32 MetaDataIndex = OutFieldBuilder-&gt;AddMetaData(InMetaData);

	TArrayView&lt;const FFrameNumber&gt; Times = EventChannel.GetData().GetTimes();
	for (int32 Index = 0; Index &lt; Times.Num(); ++Index)
	{
		if (EffectiveRange.Contains(Times[Index]))
		{
			TRange&lt;FFrameNumber&gt; Range(Times[Index]);
			OutFieldBuilder-&gt;AddOneShotEntity(Range, this, Index, MetaDataIndex);
		}
	}

	return true;
}

void UMovieSceneNewEventTriggerSection::ImportEntityImpl(UMovieSceneEntitySystemLinker* EntityLinker,
	const FEntityImportParams&amp; Params, FImportedEntity* OutImportedEntity)
{
	using namespace UE::MovieScene;

	const int32 EventIndex = static_cast&lt;int32&gt;(Params.EntityID);

	TArrayView&lt;const FFrameNumber&gt; Times = EventChannel.GetData().GetTimes();
	TArrayView&lt;const FMovieSceneNewEvent&gt; Events = EventChannel.GetData().GetValues();
	if (!ensureMsgf(Events.IsValidIndex(EventIndex), TEXT("Attempting to import an event entity for an invalid index (Index: %d, Num: %d)"), EventIndex, Events.Num()))
	{
		return;
	}

	if (Events[EventIndex].EventName.IsEmpty())
	{
		return;
	}

	UMovieSceneNewEventTrack* EventTrack = GetTypedOuter&lt;UMovieSceneNewEventTrack&gt;();
	const FSequenceInstance&amp; ThisInstance = EntityLinker-&gt;GetInstanceRegistry()-&gt;GetInstance(Params.Sequence.InstanceHandle);
	FMovieSceneContext Context = ThisInstance.GetContext();

	if (Context.GetStatus() == EMovieScenePlayerStatus::Stopped || Context.IsSilent())
	{
		return;
	}

	// Get the logic executor system
	UMovieSceneNewEventSystem* EventSystem = EntityLinker-&gt;LinkSystem&lt;UMovieSceneNewEventSystem&gt;();

	FMovieSceneNewEventTriggerData TriggerData = {
		Events[EventIndex].EventName,
		Times[EventIndex] * Context.GetSequenceToRootTransform()
	};

	EventSystem-&gt;AddEvent(ThisInstance.GetRootInstanceHandle(), TriggerData);

	// Mimic the structure changing in order to ensure that the instantiation phase runs
	EntityLinker-&gt;EntityManager.MimicStructureChanged();
}
</pre></table></code></div></div><ul><li><em>ImportEntityImpl</em> function create <strong>FMovieSceneNewEventTriggerData</strong> instances based on event data stores in <strong>FMovieSceneNewEventChannel</strong> class, and push them to <strong>UMovieSceneNewEventSystem</strong> class for evaluation purpose. It will be invoked when any event should be triggered during evaluation.<li><em>PopulateEvaluationFieldImpl</em> function adds existing events to track builder that ensure all events are rendered in <em>Sequencer</em> window.</ul><h4 id="umoviesceneneweventsystem"><span class="mr-2">UMovieSceneNewEventSystem</span><a href="#umoviesceneneweventsystem" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><strong>UMovieSceneNewEventSystem</strong> class takes passed in <strong>FMovieSceneNewEventTriggerData</strong> and execute the actual event logic based on data inside trigger data instances.</p><div file="MovieSceneNewEventSystem.h" class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="MovieSceneNewEventSystem.h"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
</pre><td class="rouge-code"><pre>class IMovieScenePlayer;

USTRUCT()
struct FMovieSceneNewEventTriggerData
{
	GENERATED_BODY()

	UPROPERTY()
	FString TriggerName;

	FFrameTime RootTime;
};

UCLASS()
class CUSTOMIZETRACK_API UMovieSceneNewEventSystem : public UMovieSceneEntitySystem
{
	GENERATED_BODY()
public:

	void AddEvent(UE::MovieScene::FInstanceHandle RootInstance, const FMovieSceneNewEventTriggerData&amp; TriggerData);

	// UMovieSceneEntitySystem interface
	virtual void OnRun(FSystemTaskPrerequisites&amp; InPrerequisites, FSystemSubsequentTasks&amp; Subsequents) override;
	virtual bool IsRelevantImpl(UMovieSceneEntitySystemLinker* InLinker) const override;

protected:

	bool HasEvents() const;
	void TriggerAllEvents();

private:

	static void TriggerEvents(TArrayView&lt;const FMovieSceneNewEventTriggerData&gt; Events, IMovieScenePlayer* Player);

private:
	TMap&lt;UE::MovieScene::FInstanceHandle, TArray&lt;FMovieSceneNewEventTriggerData&gt;&gt; EventsByRoot;
};
</pre></table></code></div></div><div file="MovieSceneNewEventSystem.cpp" class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="MovieSceneNewEventSystem.cpp"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
</pre><td class="rouge-code"><pre>DECLARE_CYCLE_STAT(TEXT("NewEvent Systems"), MovieSceneEval_NewEvents, STATGROUP_MovieSceneECS);
DECLARE_CYCLE_STAT(TEXT("Trigger NewEvents"), MovieSceneEval_TriggerNewEvents, STATGROUP_MovieSceneECS);

bool UMovieSceneNewEventSystem::HasEvents() const
{
	return EventsByRoot.Num() &gt; 0;
}

bool UMovieSceneNewEventSystem::IsRelevantImpl(UMovieSceneEntitySystemLinker* InLinker) const
{
	return HasEvents();
}

void UMovieSceneNewEventSystem::AddEvent(UE::MovieScene::FInstanceHandle RootInstance,
	const FMovieSceneNewEventTriggerData&amp; TriggerData)
{
	check(!TriggerData.TriggerName.IsEmpty());
	EventsByRoot.FindOrAdd(RootInstance).Add(TriggerData);
}

void UMovieSceneNewEventSystem::OnRun(FSystemTaskPrerequisites&amp; InPrerequisites, FSystemSubsequentTasks&amp; Subsequents)
{
	if (HasEvents())
	{
		TriggerAllEvents();
	}
}

void UMovieSceneNewEventSystem::TriggerAllEvents()
{
	using namespace UE::MovieScene;

	SCOPE_CYCLE_COUNTER(MovieSceneEval_NewEvents);

	FInstanceRegistry* InstanceRegistry = Linker-&gt;GetInstanceRegistry();
	struct FTriggerBatch
	{
		TArray&lt;FMovieSceneNewEventTriggerData&gt; TriggerData;
		IMovieScenePlayer* Player;
	};
	TArray&lt;FTriggerBatch&gt; TriggerBatches;

	for (TPair&lt;FInstanceHandle, TArray&lt;FMovieSceneNewEventTriggerData&gt;&gt;&amp; Pair : EventsByRoot)
	{
		const FSequenceInstance&amp; RootInstance = InstanceRegistry-&gt;GetInstance(Pair.Key);

		if (RootInstance.GetContext().GetDirection() == EPlayDirection::Forwards)
		{
			Algo::SortBy(Pair.Value, &amp;FMovieSceneNewEventTriggerData::RootTime);
		}
		else
		{
			Algo::SortBy(Pair.Value, &amp;FMovieSceneNewEventTriggerData::RootTime, TGreater&lt;&gt;());
		}

		FTriggerBatch&amp; TriggerBatch = TriggerBatches.Emplace_GetRef();
		TriggerBatch.TriggerData = Pair.Value;
		TriggerBatch.Player = RootInstance.GetPlayer();
	}

	// We need to clean our state before actually triggering the events because one of those events could
	// call back into an evaluation (for instance, by starting play on another sequence). If we don't clean
	// this before, would would re-enter and re-trigger past events, resulting in an infinite loop!
	EventsByRoot.Empty();

	for (const FTriggerBatch&amp; TriggerBatch : TriggerBatches)
	{
		TriggerEvents(TriggerBatch.TriggerData, TriggerBatch.Player);
	}
}

void UMovieSceneNewEventSystem::TriggerEvents(TArrayView&lt;const FMovieSceneNewEventTriggerData&gt; Events,
	IMovieScenePlayer* Player)
{
	for (const FMovieSceneNewEventTriggerData&amp; Event : Events)
	{
		SCOPE_CYCLE_COUNTER(MovieSceneEval_TriggerNewEvents);

		UE_LOG(LogTemp, Log, TEXT("[NewEvent] %s"), *Event.TriggerName);
	}
}
</pre></table></code></div></div><ul><li><em>IsRelevantImpl</em> function decides whether this system is available when try to access it by <strong>EntityLinker</strong>.<li><em>OnRun</em> is the function contains need logic to execute events. In this case, the system only print a log when event is triggered.</ul><h4 id="fmoviesceneneweventchannel"><span class="mr-2">FMovieSceneNewEventChannel</span><a href="#fmoviesceneneweventchannel" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><strong>FMovieSceneNewEventChannel</strong> manipulates all event data for parent section.</p><div file="MovieSceneNewEventChannel.h" class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="MovieSceneNewEventChannel.h"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
</pre><td class="rouge-code"><pre>USTRUCT()
struct CUSTOMIZETRACK_API FMovieSceneNewEventChannel : public FMovieSceneChannel
{
	GENERATED_BODY()

	FORCEINLINE TMovieSceneChannelData&lt;FMovieSceneNewEvent&gt; GetData()
	{
		return TMovieSceneChannelData&lt;FMovieSceneNewEvent&gt;(&amp;KeyTimes, &amp;KeyValues, &amp;KeyHandles);
	}

	/**
	 * Constant version of GetData()
	 */
	FORCEINLINE TMovieSceneChannelData&lt;const FMovieSceneNewEvent&gt; GetData() const
	{
		return TMovieSceneChannelData&lt;const FMovieSceneNewEvent&gt;(&amp;KeyTimes, &amp;KeyValues);
	}

	FORCEINLINE TArrayView&lt;const FFrameNumber&gt; GetTimes() const
	{
		return KeyTimes;
	}

	FORCEINLINE TArrayView&lt;const FMovieSceneNewEvent&gt; GetValues() const
	{
		return KeyValues;
	}

	// FMovieSceneChannel interface
	virtual void GetKeys(const TRange&lt;FFrameNumber&gt;&amp;
		WithinRange, TArray&lt;FFrameNumber&gt;* OutKeyTimes, TArray&lt;FKeyHandle&gt;* OutKeyHandles) override;
	virtual void GetKeyTimes(TArrayView&lt;const FKeyHandle&gt; InHandles, TArrayView&lt;FFrameNumber&gt; OutKeyTimes) override;
	virtual void SetKeyTimes(TArrayView&lt;const FKeyHandle&gt; InHandles, TArrayView&lt;const FFrameNumber&gt; InKeyTimes) override;
	virtual void DuplicateKeys(TArrayView&lt;const FKeyHandle&gt; InHandles, TArrayView&lt;FKeyHandle&gt; OutNewHandles) override;
	virtual void DeleteKeys(TArrayView&lt;const FKeyHandle&gt; InHandles) override;
	virtual void DeleteKeysFrom(FFrameNumber InTime, bool bDeleteKeysBefore) override;
	virtual void ChangeFrameResolution(FFrameRate SourceRate, FFrameRate DestinationRate) override;
	virtual TRange&lt;FFrameNumber&gt; ComputeEffectiveRange() const override;
	virtual int32 GetNumKeys() const override;
	virtual void Reset() override;
	virtual void Offset(FFrameNumber DeltaPosition) override;

private:
	UPROPERTY(meta=(KeyTimes))
	TArray&lt;FFrameNumber&gt; KeyTimes;

	UPROPERTY(meta=(KeyValues))
	TArray&lt;FMovieSceneNewEvent&gt; KeyValues;

	FMovieSceneKeyHandleMap KeyHandles;
};

namespace MovieSceneClipboard
{
	template&lt;&gt; inline FName GetKeyTypeName&lt;FMovieSceneNewEvent&gt;()
	{
		return "MovieSceneNewEvent";
	}
}

template&lt;&gt;
struct TMovieSceneChannelTraits&lt;FMovieSceneNewEventChannel&gt; : TMovieSceneChannelTraitsBase&lt;FMovieSceneNewEventChannel&gt;
{
	enum { SupportsDefaults = false };
};

inline bool EvaluateChannel(const FMovieSceneNewEventChannel* InChannel, FFrameTime InTime, FMovieSceneNewEvent&amp; OutValue)
{
	// Can't evaluate event section data in the typical sense
	return false;
}
</pre></table></code></div></div><blockquote class="prompt-tip"><div><p>Notice that some individual functions are also placed here. They are neccessary for register channel interface in editor module later.</p></div></blockquote><div file="MovieSceneNewEventChannel.cpp" class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="MovieSceneNewEventChannel.cpp"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
</pre><td class="rouge-code"><pre>void FMovieSceneNewEventChannel::GetKeys(const TRange&lt;FFrameNumber&gt;&amp; WithinRange, TArray&lt;FFrameNumber&gt;* OutKeyTimes,
	TArray&lt;FKeyHandle&gt;* OutKeyHandles)
{
	GetData().GetKeys(WithinRange, OutKeyTimes, OutKeyHandles);
}

void FMovieSceneNewEventChannel::GetKeyTimes(TArrayView&lt;const FKeyHandle&gt; InHandles,
	TArrayView&lt;FFrameNumber&gt; OutKeyTimes)
{
	GetData().GetKeyTimes(InHandles, OutKeyTimes);
}

void FMovieSceneNewEventChannel::SetKeyTimes(TArrayView&lt;const FKeyHandle&gt; InHandles,
	TArrayView&lt;const FFrameNumber&gt; InKeyTimes)
{
	GetData().SetKeyTimes(InHandles, InKeyTimes);
}

void FMovieSceneNewEventChannel::DuplicateKeys(TArrayView&lt;const FKeyHandle&gt; InHandles,
	TArrayView&lt;FKeyHandle&gt; OutNewHandles)
{
	GetData().DuplicateKeys(InHandles, OutNewHandles);
}

void FMovieSceneNewEventChannel::DeleteKeys(TArrayView&lt;const FKeyHandle&gt; InHandles)
{
	GetData().DeleteKeys(InHandles);
}

void FMovieSceneNewEventChannel::DeleteKeysFrom(FFrameNumber InTime, bool bDeleteKeysBefore)
{
	GetData().DeleteKeysFrom(InTime, bDeleteKeysBefore);
}

void FMovieSceneNewEventChannel::ChangeFrameResolution(FFrameRate SourceRate, FFrameRate DestinationRate)
{
	GetData().ChangeFrameResolution(SourceRate, DestinationRate);
}

TRange&lt;FFrameNumber&gt; FMovieSceneNewEventChannel::ComputeEffectiveRange() const
{
	return GetData().GetTotalRange();
}

int32 FMovieSceneNewEventChannel::GetNumKeys() const
{
	return KeyTimes.Num();
}

void FMovieSceneNewEventChannel::Reset()
{
	KeyTimes.Reset();
	KeyValues.Reset();
	KeyHandles.Reset();
}

void FMovieSceneNewEventChannel::Offset(FFrameNumber DeltaPosition)
{
	GetData().Offset(DeltaPosition);
}
</pre></table></code></div></div><p>According the source code above, this class is only a wrapper class without actual logic. KeyTimes, KeyValues and KeyHandles are the key variables.</p><h4 id="fmoviescenenewevent"><span class="mr-2">FMovieSceneNewEvent</span><a href="#fmoviescenenewevent" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Finally, here is the event definition struct. A single <strong>FString</strong> variable is enought for this example.</p><div file="MovieSceneNewEvent.h" class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="MovieSceneNewEvent.h"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>USTRUCT(BlueprintType)
struct FMovieSceneNewEvent
{
	GENERATED_BODY()

	UPROPERTY(EditAnywhere, Category="NewEvent")
	FString EventName;
};

</pre></table></code></div></div><h3 id="editor-module-1"><span class="mr-2">Editor Module</span><a href="#editor-module-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>For event track, it’s necessary to register channel interface for new track. Open module source file and change the <em>StartupModule()</em> function like following.</p><div file="CustomizeTrackEditor.cpp" class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="CustomizeTrackEditor.cpp"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre>void FCustomizeTrackEditorModule::StartupModule()
{
	UE_LOG(LogTemp, Log, TEXT("[CustomizeTrackEditor] Startup"));

	ISequencerModule&amp; SequencerModule = FModuleManager::Get().LoadModuleChecked&lt;ISequencerModule&gt;("Sequencer");
	// Register new track editor
	NewTrackCreateEditorHandle = SequencerModule.RegisterTrackEditor(FOnCreateTrackEditor::CreateStatic(&amp;FNewTrackEditor::CreateTrackEditor));
	NewEventTrackCreateEditorHandle = SequencerModule.RegisterTrackEditor(FOnCreateTrackEditor::CreateStatic(&amp;FNewEventTrackEditor::CreateTrackEditor));

	// Register new channel interface
	SequencerModule.RegisterChannelInterface&lt;FMovieSceneNewEventChannel&gt;();
}
</pre></table></code></div></div><blockquote class="prompt-tip"><div><p>Ensure that header file <strong>“SequencerChannelInterface.h”</strong> is included. Otherwise project will not be compiled.</p></div></blockquote><p>The section renderer and editor menu construtor classes can be added like section track’s, no more detail about them.</p><p><img data-src="/img/2022-05-04-How-To-Add-Customized-Sequence-Track/UE-New-Event-Track.png" alt="UE-New-Event-Track" data-proofer-ignore> <em>New Event Track</em></p><h2 id="example-code"><span class="mr-2">Example Code</span><a href="#example-code" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>The example project shows in this article can be found <a href="https://github.com/cymhellfire/Blogging/tree/main/Plugins/CustomizeTrack"><strong>here</strong></a>.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/unreal-engine/'>Unreal Engine</a>, <a href='/categories/editor/'>Editor</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/how-to/" class="post-tag no-text-decoration" >how to</a> <a href="/tags/sequencer/" class="post-tag no-text-decoration" >sequencer</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=How+to+Add+Customized+Sequence+Track+-+Vault&url=https%3A%2F%2Fcymhellfire.github.io%2Fposts%2FHow-To-Add-Customized-Sequence-Track%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=How+to+Add+Customized+Sequence+Track+-+Vault&u=https%3A%2F%2Fcymhellfire.github.io%2Fposts%2FHow-To-Add-Customized-Sequence-Track%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fcymhellfire.github.io%2Fposts%2FHow-To-Add-Customized-Sequence-Track%2F&text=How+to+Add+Customized+Sequence+Track+-+Vault" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/Recover-Git-Repo-After-Reinstalled-OS/">Recover Git Repo after Reinstalled OS</a><li><a href="/posts/How-To-Add-Customized-Sequence-Track/">How to Add Customized Sequence Track</a><li><a href="/posts/How-To-Add-New-Viewport-In-Editor/">How to Add New Viewport in Editor</a><li><a href="/posts/TOptional/">TOptional Nullable Struct Variable</a><li><a href="/posts/What-Happened-After-Press-Play-Button-In-Editor/">What Happened after Press Play Button in Editor</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/how-to/">how to</a> <a class="post-tag" href="/tags/learning-ue/">learning ue</a> <a class="post-tag" href="/tags/utils/">utils</a> <a class="post-tag" href="/tags/git/">git</a> <a class="post-tag" href="/tags/sequencer/">sequencer</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4 mt-5"><div id="related-posts" class="mb-2 mb-sm-4"><h3 class="pt-2 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/How-To-Add-New-Viewport-In-Editor/"><div class="card-body"> <em class="small" data-ts="1650680184" data-df="ll" > Apr 23, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>How to Add New Viewport in Editor</h3><div class="text-muted small"><p> This article will introduce how to add a customized viewport of current level in Unreal Editor. All content are based on Unreal Engine 4.27.2 (binary version from Epic Game Launcher). Other ver...</p></div></div></a></div><div class="card"> <a href="/posts/Recover-Git-Repo-After-Reinstalled-OS/"><div class="card-body"> <em class="small" data-ts="1667227582" data-df="ll" > Oct 31, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Recover Git Repo after Reinstalled OS</h3><div class="text-muted small"><p> What’s the Problem Like Let’s take a look at the phenomenon of this problem. If you reinstall the operation system with some Git repositories on disk, they will be unusable with the new OS as defa...</p></div></div></a></div><div class="card"> <a href="/posts/How-To-Fix-Module-Circular-Dependency/"><div class="card-body"> <em class="small" data-ts="1651460185" data-df="ll" > May 2, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>How to Fix Module Circular Dependency</h3><div class="text-muted small"><p> Circular Dependency is a common issue when developping with multiple modules. It will block the compile process of the project. This article will introduce two different ways to solve this problem....</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/How-To-Fix-Module-Circular-Dependency/" class="btn btn-outline-primary" prompt="Older"><p>How to Fix Module Circular Dependency</p></a> <a href="/posts/Recover-Git-Repo-After-Reinstalled-OS/" class="btn btn-outline-primary" prompt="Newer"><p>Recover Git Repo after Reinstalled OS</p></a></div></div></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/how-to/">how to</a> <a class="post-tag" href="/tags/learning-ue/">learning ue</a> <a class="post-tag" href="/tags/utils/">utils</a> <a class="post-tag" href="/tags/git/">git</a> <a class="post-tag" href="/tags/sequencer/">sequencer</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><footer><div class="container pl-lg-4 pr-lg-4"><div class="d-flex justify-content-between align-items-center text-muted ml-md-3 mr-md-3"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://github.com/cymhellfire">alexymcai</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></div></footer><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/unregister.js"></script>
